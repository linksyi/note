## 普通所以和唯一索引，应该怎么选择

### 查询过程

​		我们知道，一个查询语句会在索引树上查找，先是通过B+树从树根开始，按层搜索到叶子节点，然后通过从数据页内部通过二分法来定位数据，不同索引有一下两种情况

- 对于普通索引来说，查询条件满足后，需要查询下一个记录，直到碰到不满足索引的记录。
- 对于唯一索引来说，在B+树中查询数据，如果查询到数据，因为唯一索引特性，将不会继续查询
- 

​		那么，带来的性能差距会有多少呢，其实是微乎其微

​		因为mysql查询其实查询单位是以页为单位，而没个数据页默认大小为16K。

### change buffer

在mysql数据存储中包含**内存**与**磁盘**两个部分。

chang buffer会缓存最热的数据页与索引页。

---

### 更新过程

更新过程分一下两种情况：

- 命中change buffer缓存时，直接修改缓存中数据，然后定时将change buffer中数据写入磁盘
- 当修改数据不存在change buffer缓存中时，将数据先从磁盘中读取然后缓存到change buffer中，其次开始更新change buffer缓存，最后定时将change buffer写入磁盘

​		对于唯一索引来说，所有更新操作都要判断这个操作是否违反唯一约束，所以在进行更新操作时，不管change buffer中是否存在当前数据，都需要去磁盘上查询判断，所以就没必要使用change buffer。

---

### change buffer 的使用场景

​		已经清楚了change buffer只限于用在普通索引的场景下，那么使用change buffer都可以起到加速作用吗？

​		因为 merge 的时候是真正进行数据更新的时刻，而 change buffer 的主要目的就是将记录的变更动作缓存下来，所以在一个数据页做 merge 之前，change buffer 记录的变更越多（也就是这个页面上要更新的次数越多），收益就越大。

