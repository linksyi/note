## 参数innodb_file_per_table

表数据是可以存在共享表空间里，也可以是淡出的文件。mysql通过innodb_file_per_table参数控制：

> 1. 这个参数设置为OFF表示的是，表的数据存在系统共享表空里，也就是跟数据字典放在一起
> 2. 这个参数为ON表示，没个Innodb表数据存在一个以.ibd为后缀的文件中

​		在mysql5.6.6开始，默认值为ON，一个表单独存储为一个文件更容易管理，而且在你不需要这个表的时候，通过drop table命令，系统就会直接删除这个文件。而如果放在空想表空间中，及时表删除了，空间也不会回收

## 数据删除流程

​		在我们删除数据时，mysql并不会马上将数据从磁盘中抹去，而是将数据标记为可复用状态，当我们插入新的值时，所计算出存放位置为标记为可复用状态的数据时，就会将其进行覆盖，这也就是为什么在使用delete删除数据是磁盘文件并不会发生改变。

​		相同的，如果我们删除了一个数据页上的所有数据，数据页也不会被清理，而是整个数据页都可以被复用。但是数据页被复用与数据复用逻辑不相同，当B+书需要申请新的数据页时，数据页就会被复用，不在先于数据存储位置是否符合条件。

## 清理表

​		因为innodb底层机制并不会直接将数据给删除，而是进行标记，这时我们的磁盘存储文件就会造成很多的空洞。所以我们需要将这些空洞去掉，就能达到清理磁盘存储数据大小原因。

### 重建表

​		重建表能达到清理表中所存在的空洞去掉，我们需要新建一个与表A数据结构相同的表B，然后按照主键ID递增的顺序，把数据一行一行的从表A的数据读取出入然后插入到表B中。可以使用 以下命令进行重建表，该命令会自动完成转存数据、交换表明、删除旧表的操作。

```mysql
alter table [talbeName] engine=InnoDb
```

![250E11A9-C6D4-442A-A48A-2FAEEE27EDC0](https://gitee.com/zuoyii/picture/raw/master/img/250E11A9-C6D4-442A-A48A-2FAEEE27EDC0.png)